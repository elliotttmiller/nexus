# üîß Complete Railway Deployment & Configuration Guide

## Step-by-Step Deployment Instructions

### Phase 1: Deploy AI Service First

1. **Create nexus-ai Railway Service**
   ```bash
   # In Railway Dashboard:
   # 1. New Project
   # 2. Deploy from GitHub repo: elliotttmiller/nexus
   # 3. Set Root Directory: nexus-ai/
   # 4. Service Name: nexus-ai-production
   ```

2. **Configure nexus-ai Environment Variables**
   ```
   GOOGLE_API_KEY=your_actual_google_api_key_here
   HOST=0.0.0.0
   PORT=8000
   ENVIRONMENT=production
   LOG_LEVEL=INFO
   ```

3. **Note the AI Service URL**
   ```
   Example: https://nexus-ai-production-abc123.up.railway.app
   ```

### Phase 2: Deploy Backend Service

1. **Create nexus-backend Railway Service**
   ```bash
   # In Railway Dashboard:
   # 1. New Service in same project
   # 2. Deploy from GitHub repo: elliotttmiller/nexus  
   # 3. Set Root Directory: nexus-backend/
   # 4. Service Name: nexus-backend-production
   ```

2. **Add PostgreSQL Database**
   ```bash
   # In Railway Project:
   # 1. New Service ‚Üí Database ‚Üí PostgreSQL
   # 2. Copy DATABASE_URL from database variables
   ```

3. **Configure nexus-backend Environment Variables**
   ```
   NODE_ENV=production
   PORT=8080
   DATABASE_URL=[Auto-generated by Railway PostgreSQL]
   JWT_SECRET=e19d51762a935f5e3bf94c670a535f466f12f6fa06fc1f4b3dc52ddaf733efc6
   JWT_EXPIRES_IN=24h
   PLAID_CLIENT_ID=6878c62f8325000026a8eb6f
   PLAID_SECRET=7bf17d0cab6c264862db25dbb58516
   PLAID_ENV=sandbox
   AI_BASE_URL=https://nexus-ai-production-abc123.up.railway.app
   SENTRY_DSN=https://6870589f945b88361cbb65079060a3ce@o4509683080822784.ingest.us.sentry.io/4509683186204672
   CORS_ORIGIN=https://nexus-production-2e34.up.railway.app,http://localhost:3000
   LOG_LEVEL=info
   ```

### Phase 3: Update Mobile App Configuration

1. **Verify eas.json Configuration**
   ```json
   {
     "build": {
       "production": {
         "env": {
           "EXPO_PUBLIC_API_BASE_URL": "https://nexus-backend-production-xyz789.up.railway.app"
         }
       }
     }
   }
   ```

### Phase 4: Test Deployment

1. **Test Backend Health**
   ```bash
   curl https://nexus-backend-production-xyz789.up.railway.app/
   # Expected: {"status":"ok","message":"Nexus Backend is healthy."}
   ```

2. **Test AI Service Health**
   ```bash
   curl https://nexus-ai-production-abc123.up.railway.app/health
   # Expected: {"status":"ok"}
   ```

3. **Test Critical Endpoints**
   ```bash
   # Test accounts endpoint (should return mock data)
   curl "https://nexus-backend-production-xyz789.up.railway.app/api/plaid/accounts?userId=1"
   
   # Test AI recommendations endpoint
   curl -X POST https://nexus-backend-production-xyz789.up.railway.app/api/interestkiller/pay/ai-recommendation \
     -H "Content-Type: application/json" \
     -d '{"userId":1,"accounts":[{"id":"test","name":"Test Card","balance":1000,"apr":18.99,"creditLimit":5000,"type":"credit"}],"payment_amount":500}'
   ```

## Current Issue Analysis

Based on test results, the Railway services are not responding (HTTP 000), indicating:

1. **Services not deployed yet** - Need to deploy following above steps
2. **Environment variables missing** - Critical `AI_BASE_URL` not configured
3. **Database connection issues** - PostgreSQL not configured
4. **Google API key missing** - AI service cannot start without valid key

## Critical Environment Variables Checklist

### nexus-backend MUST HAVE:
- ‚úÖ `AI_BASE_URL` ‚Üí Points to actual Railway AI service URL
- ‚úÖ `DATABASE_URL` ‚Üí Railway PostgreSQL connection string
- ‚úÖ `PLAID_CLIENT_ID` & `PLAID_SECRET` ‚Üí Sandbox credentials
- ‚úÖ `JWT_SECRET` ‚Üí For authentication

### nexus-ai MUST HAVE:
- ‚ùå `GOOGLE_API_KEY` ‚Üí **CRITICAL** - AI service cannot function without this

## Expected TestFlight Results After Fix

1. **Accounts Screen**: ‚úÖ Loads mock credit card data without "Failed to load financial data" error
2. **Pay Screen**: ‚úÖ Generates AI recommendations without "Failed to get AI recommendations" error  
3. **Plaid Link**: ‚úÖ Sandbox login works with `user_good`/`pass_good` credentials
4. **Authentication**: ‚úÖ Login/logout continues working
5. **End-to-End Flow**: ‚úÖ Login ‚Üí View Accounts ‚Üí Get AI Recommendation works completely

## Validation Commands

Use the provided `test_api_endpoints.sh` script to validate deployment:

```bash
./test_api_endpoints.sh
```

All endpoints should return ‚úÖ SUCCESS after proper configuration.